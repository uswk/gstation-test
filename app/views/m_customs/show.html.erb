<% if params[:header_no_dsp].blank? %>
  <h1>ステーション詳細画面</h1>
<% end %>
<table>
  <thead>
    <tr>
      <th colspan=2>ステーションコード</th>
      <td colspan=2><%= @m_custom.cust_code %></td>
      <td rowspan=19 width=40% valign="top">
        <div class="map_container" style="width:96%;">
          <div id="map_canvas" style="width:100%; height:500px"></div>
        </div>
      </td>
    </tr>
    <tr>
      <th colspan=2>ステーション名</th>
      <td colspan=2><%= @m_custom.cust_name %></td>
    </tr>
    <tr>
      <th colspan=2>住所</th>
      <td colspan=2><%= @m_custom.addr_1 %></td>
    </tr>
    <tr>
      <th colspan=2>ｱﾊﾟｰﾄ・ﾏﾝｼｮﾝ・ﾋﾞﾙ名</th>
      <td colspan=2><%= @m_custom.addr_2 %></td>
    </tr>
    <tr>
      <th rowspan=5>管理者</th>
      <th>コード</th>
      <td colspan=2><%= @m_custom.admin_code %></td>
    </tr>
    <tr>
      <th>名称</th>
      <td colspan=2><%= @m_custom.admin_name %></td>
    </tr>
    <tr>
      <th>種別</th>
      <td colspan=2><%= @m_custom.type_name %></td>
    </tr>
    <tr>
      <th>電話番号</th>
      <td colspan=2><%= @m_custom.admin_tel %></td>
    </tr>
    <tr>
      <th>Ｅメール</th>
      <td colspan=2><%= @m_custom.admin_email %></td>
    </tr>
    <tr>
      <th colspan=2>使用内容</th>
      <td colspan=2><%= @m_custom.use_content_name %></td>
    </tr>
    <tr>
      <th colspan=2>利用世帯数</th>
      <td colspan=2><%= @m_custom.setai_count %></td>
    </tr>
    <tr>
      <th colspan=2>利用人数</th>
      <td colspan=2><%= @m_custom.use_count %></td>
    </tr>
    <tr>
      <th colspan=2>備考</th>
      <td colspan=2><%= text_area "memo", "", :value=> @m_custom.memo, :rows=>2, :readonly=>true %></td>
    </tr>
    <tr>
      <th colspan=2>添付画像</th>
      <td colspan=2>
        <% if !@m_custom.icon.blank? %>
          <a href="<%= @m_custom.icon.url(:original) %>" data-lightbox="gallery"><%= image_tag @m_custom.icon.url(:medium) %></a>
        <% end %>
      </td>
    </tr>
    <tr>
      <th colspan=2>申請日</th>
      <td colspan=2><%= @m_custom.shinsei_date.nil? ? "" : @m_custom.shinsei_date.strftime("%Y-%m-%d") %></td>
    </tr>
    <tr>
      <th colspan=2>収集開始日</th>
      <td colspan=2><%= @m_custom.start_date.nil? ? "" : @m_custom.start_date.strftime("%Y-%m-%d") %></td>
    </tr>
    <tr>
      <th colspan=2>廃止届出受付日</th>
      <td colspan=2><%= @m_custom.haishi_date.nil? ? "" : @m_custom.haishi_date.strftime("%Y-%m-%d") %></td>
    </tr>
    <tr>
      <th colspan=2>集配停止日</th>
      <td colspan=2><%= @m_custom.end_date.nil? ? "" : @m_custom.end_date.strftime("%Y-%m-%d") %></td>
    </tr>
    <tr>
      <th colspan=2>緯度</th>
      <td colspan=2><%= @m_custom.latitude %></td>
    </tr>
    <tr>
      <th colspan=2>経度</th>
      <td colspan=2><%= @m_custom.longitude %></td>
    </tr>
    <% @iCount = 0 %>
    <% @m_route_points.each do |m_route_point| %>
      <tr>
        <% if @iCount == 0 %>
          <th colspan=2 rowspan="<%= @m_route_points.length %>">収集区</th>
        <% end %>
        <td>
          <%= m_route_point.route_code.to_s + ':' + m_route_point.route_name %>
        </td>
        <td>
          <%= m_route_point.itaku_name.to_s %>
        </td>
        <td>
          <%= sanitize(simple_format(m_route_point.route_memo.to_s), :tags => %w(br)) %>
        </td>
      </tr>
      <% @iCount = @iCount + 1 %>
    <% end %>
  </thead>
</table>
<br>
<% if not @header_no_dsp %>
  <% if not @routecode %>
    <% if params[:lat_del] %>
      <% if current_user.authority!=9 %>
        <% @url_para = m_customs_path + "/" + params[:id] + "/edit?zoom_del=" + params[:zoom_del] + "&lat_del=" + params[:lat_del] + "&lng_del=" + params[:lng_del] %>
        <%= link_to '編集', @url_para, :class => 'btn btn-light', :style=>'text-decoration:none;' %>&nbsp;&nbsp;
      <% end %>
      <% @url_para = m_custom_add_path + "?zoom_del=" + params[:zoom_del] + "&lat_del=" + params[:lat_del] + "&lng_del=" + params[:lng_del] %>
      <%= link_to '戻る', @url_para, :class => 'btn btn-light', :style=>'text-decoration:none;' %>
    <% elsif params[:lat_map] %>
      <% @url_para = search_maps_path + "?zoom_map=" + params[:zoom_map] + "&lat_map=" + params[:lat_map] + "&lng_map=" + params[:lng_map] %>
      <%= link_to '戻る', @url_para, :class => 'btn btn-light', :style=>'text-decoration:none;' %>
    <% else %>
      <% if current_user.authority!=9 %>
        <%= link_to '編集', edit_m_custom_path(@m_custom, :hold_params=>1,:search_page=>params[:search_page].to_s,:search_custcode=>params[:search_custcode].to_s,:search_custname=>params[:search_custname].to_s,:search_custaddr=>params[:search_custaddr].to_s,:search_custadmin=>params[:search_custadmin].to_s,:search_routecode=>params[:search_routecode].to_s,:search_custpage=>params[:search_custpage].to_s,:search_delete=>params[:search_delete].to_s), :class => 'btn btn-light', :style=>'text-decoration:none;' %>&nbsp;&nbsp;
      <% end %>
      <%= link_to '戻る', m_customs_path(:hold_params=>1,:page=>params[:search_page].to_s,:search_custcode=>params[:search_custcode].to_s,:search_custname=>params[:search_custname].to_s,:search_custaddr=>params[:search_custaddr].to_s,:search_custadmin=>params[:search_custadmin].to_s,:search_routecode=>params[:search_routecode].to_s,:search_custpage=>params[:search_custpage].to_s,:search_delete=>params[:search_delete].to_s), :class => 'btn btn-light', :style=>'text-decoration:none;' %>
    <% end %>
  <% else %>
    <% @url_para = m_route_points_path + "?zoom_del=" + params[:zoom_del] + "&lat_del=" + params[:lat_del] + "&lng_del=" + params[:lng_del] + "&routecode=" + @routecode %>
    <%= link_to '戻る', @url_para, :class => 'btn btn-light', :style=>'text-decoration:none;' %>
  <% end %>
<% else %>
  <input type="button" id="modalClose" value="閉じる" onclick="modal_close()" class='btn btn-light'>
<% end %>

<% content_for :scripts do %>
  <script src="//maps.googleapis.com/maps/api/js?v=3.23&language=ja&key=<%= @map_key %>"></script>
  <script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" type="text/javascript"></script>
  <script type="text/javascript" charset="utf-8">

google.maps.event.addDomListener(window, 'load', function()
{
  var infowindow;
  var myLatlng;
  var marker;
  var custcode = "<%= @m_custom.cust_code %>";
  var custname = "<%= @m_custom.cust_name %>";

  myLatlng = new google.maps.LatLng("<%= @m_custom.latitude.to_s %>","<%= @m_custom.longitude.to_s %>");
  var mapOptions = {
    auto_zoom: true,
    zoom: 18,
    auto_adjust: false,
    center: myLatlng,
    gestureHandling: "greedy",
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }
  var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
  infowindow = new google.maps.InfoWindow({
        content: '<div style="width:220px; height:120px;" class="popup"><h2>'+ custcode +  '</h2><p>' + custname + '</p>'
  });
  marker = new google.maps.Marker({
    position: myLatlng,
    title: "ステーション位置",
    map: map
  });
  infowindow.open(map, marker);

  google.maps.event.addListener(marker, 'click', function() {
    infowindow.open(map,marker);
  });
});

//モーダルを閉じる
function modal_close(){
  window.parent.jQuery('#modal_station_detail_common').dialog('close');
}
</script>
<% end %>
